---
import PageCursor from "../components/actions/PageCursor.astro";
import BaseLayout from "../components/BaseLayout.astro";
import Nav from "../components/Nav.astro";
import RightSidebar from "../components/Sidebars/RightSidebar.astro";
import { getConfig } from "../helpers";

const pages = await Astro.glob("/src/pages/docs/**/*.{md,mdx}");
pages.sort(sortOnSidebarPosition);

const astrosaurus = await getConfig();

const logo = astrosaurus?.site?.logo;
const title = astrosaurus?.site?.title;

function sortOnSidebarPosition(page1: any, page2: any) {
  const position1 = page1?.frontmatter?.sidebar?.position || 100;
  const position2 = page2?.frontmatter?.sidebar?.position || 100;
  return position1 - position2;
}

const currentPage = Astro.url.pathname;
---

<BaseLayout>
  <main class="flex">
    <nav class="w-96 p-8 border-r dark:border-none h-screen dark:bg-slate-900">
      <div class="flex items-center space-x-4 pb-3">
        <div
          class="bg-gray-200 dark:bg-slate-800 w-12 h-12 text-xl flex items-center justify-center rounded-lg"
        >
          {logo}
        </div>
        <span class="text-lg font-bold dark:text-white">
          {title}
        </span>
      </div>

      <ul>
        {
          pages.map((page) => (
            <a href={page.url}>
              <li
                class={`py-2 px-8 hover:bg-gray-200 dark:hover:bg-slate-800 rounded-lg  cursor-pointer ${
                  page.url == currentPage ? "text-main" : "text-gray-600"
                }  `}
              >
                {page.frontmatter.title}
              </li>
            </a>
          ))
        }
      </ul>
    </nav>
    <div class="flex-1 dark:bg-slate-800">
      <Nav />
      <div class="flex">
        <section class="px-16">
          <div class="max-w-screen-lg py-3">
            <div
              class="lg:min-w-[74ch] mx-auto my-3 prose prose-base dark:prose-invert prose-pre:text-[1rem] !prose-h2:no-underline prose-code:bg-primary/50"
            >
              <slot />
            </div>
          </div>
          <PageCursor pages={pages} currentPage={currentPage} />
        </section>
        <RightSidebar headings={Astro.props.headings || Astro?.props?.content?.astro?.headings} />
      </div>
    </div>
  </main>
</BaseLayout>
